name: Convert TODOs into Issues
# This workflow converts TODOs into issues and CLOSES the github issue once the TODO is removed
on: [push]

jobs:
  build:
    name: Convert
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: add ruby repo
        run: |
          echo adding ruby repo
          sudo apt-add-repository ppa:brightbox/ruby-ng
      - name: install ubuntu dependencies
        run: |
          echo installing ruby
          sudo apt-get update
          sudo apt-get install ruby2.6 -y
          sudo chown -R $(whoami) /var/lib/gems/2.6.0
          sudo chown -R $(whoami) /usr/local/bin
      - name: get twitter bearer token
        run: |
          echo Getting bear token
          TOKEN=$(curl \
          -H 'Accept: application/json' \
          -H 'Content-Type: application/json' \
          -u '${{secrets.twitter_consumer_key}}:${{secrets.twitter_consumer_secret}}' \
          -X POST 'https://api.twitter.com/oauth2/token' | jq -r '.access_token')
      - name: tweet update
        run: |
          echo posting update
          curl -v -G \
          -H 'Accept: application/json' \
          -H 'Content-Type: application/x-www-form-urlencoded;charset=UTF-8' \
          -H 'Authorization: Bearer ${TOKEN}' \
          -X POST 'https://api.twitter.com/1.1/statuses/update.json' \
          --data-urlencode 'status=Hello! github actions post' | jq -r '.'
